<div class="container my-4 d-flex justify-content-center">
    <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#modalExportacion">
        Exportar reporte
    </button>
</div>

<div class="modal fade" id="modalExportacion" tabindex="-1" aria-labelledby="modalExportacionLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="POST" action="{% url 'reportes:exportar_reporte' %}">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title" id="modalExportacionLabel">Exportar reporte</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="reporte" id="reporteSeleccionado">
                    <input type="hidden" name="grafico_base64" id="grafico_base64">

                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="formato" value="pdf" id="formatoPdf" checked>
                        <label class="form-check-label" for="formatoPdf">PDF</label>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="radio" name="formato" value="excel" id="formatoExcel">
                        <label class="form-check-label" for="formatoExcel">Excel</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success">Descargar</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const form = document.querySelector('#modalExportacion form');
    form.addEventListener('submit', function () {
        const formato = document.querySelector('input[name="formato"]:checked').value;

        if (formato === 'pdf') {
            let canvas = null;

            if (document.getElementById('vista-barras').style.display !== 'none') {
                canvas = document.getElementById('graficoBarras');
            } else if (document.getElementById('vista-torta').style.display !== 'none') {
                canvas = document.getElementById('graficoTorta');
            }

            if (canvas) {
                const imagenBase64 = canvas.toDataURL('image/png');
                document.getElementById('grafico_base64').value = imagenBase64;
            }
        }
    });
});
</script>
